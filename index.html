<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SunriseRP – Adminpanel</title>
<style>
body {
  font-family: 'Poppins', sans-serif;
  margin: 0;
  color: #fff;
  background: url('sunriserp.png') center/cover fixed no-repeat;
}
header {
  background: rgba(0,0,0,0.6);
  text-align: center;
  padding: 20px;
  font-size: 24px;
  text-shadow: 0 0 10px #ffbb55;
}
nav {
  text-align: center;
  background: rgba(0,0,0,0.4);
  padding: 10px;
}
nav button {
  background: rgba(255,255,255,0.15);
  border: none;
  color: #fff;
  padding: 10px 20px;
  margin: 5px;
  border-radius: 5px;
  cursor: pointer;
  transition: 0.3s;
}
nav button:hover { background: rgba(255,200,120,0.4); }

section {
  display: none;
  padding: 20px;
  margin: 20px auto;
  max-width: 1000px;
  background: rgba(0,0,0,0.55);
  border-radius: 10px;
}
section.active { display: block; }

h2, h3 {
  text-align: center;
  color: #ffbb55;
  text-shadow: 0 0 10px #ffbb55;
}

table {
  width: 100%;
  border-collapse: collapse;
  color: #fff;
}
th, td {
  border: 1px solid rgba(255,255,255,0.3);
  padding: 8px;
  text-align: center;
}
input, select, textarea, button {
  padding: 8px;
  border: none;
  border-radius: 4px;
  margin: 5px 0;
  font-family: inherit;
}
textarea { width: 95%; min-height: 60px; }
button.action-btn {
  background: #ffbb55;
  color: #000;
  border-radius: 4px;
  padding: 6px 12px;
  cursor: pointer;
  transition: 0.3s;
}
button.action-btn:hover { background: #ffd480; }

.permission-toggle {
  background: rgba(255,255,255,0.2);
  border: none;
  color: white;
  padding: 10px;
  border-radius: 5px;
  cursor: pointer;
  margin: 5px;
}
.permission-toggle.active { background: #4caf50; }
.permission-toggle.inactive { background: #c0392b; }
</style>
</head>

<body>
<header>☀️ Sunrise Roleplay – Admin Panel</header>
<nav>
  <button onclick="showSection('bewerbung')">Bewerbung</button>
  <button onclick="showSection('entbannung')">Entbannungsantrag</button>
  <button onclick="showSection('panel')">Admin Panel</button>
</nav>

<!-- BEWERBUNG -->
<section id="bewerbung" class="active">
  <h2>Bewerbung einreichen</h2>
  <form id="bewerbungForm">
    <select id="bewerbungsArt" required onchange="toggleTeamPosition()">
      <option value="Fraktionsbewerbung">Fraktionsbewerbung</option>
      <option value="Teambewerbung">Teambewerbung</option>
    </select>
    <div id="teamPositionDiv" style="display:none;">
      <select id="bewerbungPosition" required>
        <option value="Developer">Developer</option>
        <option value="Builder">Builder</option>
        <option value="Supporter">Supporter</option>
        <option value="Designer">Designer</option>
        <option value="Content Creator">Content Creator</option>
      </select>
    </div>
    <input type="text" id="bewerbungDiscord" placeholder="Discord Name" required>
    <input type="text" id="bewerbungMinecraft" placeholder="Minecraft Name" required>
    <input type="email" id="bewerbungEmail" placeholder="E-Mail" required>
    <textarea id="bewerbungText" placeholder="Bewerbungstext" required></textarea>
    <button type="submit">Absenden</button>
  </form>
</section>

<!-- ENTBANNUNG -->
<section id="entbannung">
  <h2>Entbannungsantrag</h2>
  <form id="entbannungForm">
    <input type="text" id="entbannMinecraft" placeholder="Minecraft Name" required>
    <input type="text" id="entbannDiscord" placeholder="Discord Name" required>
    <input type="email" id="entbannEmail" placeholder="E-Mail" required>
    <label><input type="checkbox" id="entbannDiscordBan"> Auch vom Discord gebannt?</label>
    <textarea id="entbannText" placeholder="Begründung" required></textarea>
    <button type="submit">Absenden</button>
  </form>
</section>

<!-- ADMIN PANEL -->
<section id="panel">
  <h2>Admin Panel</h2>
  <form id="loginForm">
    <input type="text" id="loginUser" placeholder="Benutzername" required>
    <input type="password" id="loginPass" placeholder="Passwort" required>
    <button type="submit">Login</button>
  </form>

  <div id="panelContent" style="display:none;">
    <h3>Bewerbungen</h3>
    <table id="bewerbungTable">
      <thead><tr><th>Datum</th><th>Art</th><th>Position</th><th>Discord</th><th>Minecraft</th><th>Email</th><th>Text</th></tr></thead>
      <tbody></tbody>
    </table>

    <h3>Entbannungsanträge</h3>
    <table id="entbannTable">
      <thead><tr><th>Datum</th><th>Minecraft</th><th>Discord</th><th>Email</th><th>Begründung</th><th>Discord-Ban?</th></tr></thead>
      <tbody></tbody>
    </table>

    <h3>Teamverwaltung</h3>
    <div id="teamManageArea"></div>
  </div>
</section>

<script>
const LEITUNG_PASS = "L3!t@d#SunR1$e2025";
let currentUser = null;
let team = JSON.parse(localStorage.getItem('team')) || [
  {name:"Leitung", role:"Leitung", pass:LEITUNG_PASS, permissions:{teamManage:true, teamApps:true, fracApps:true, bans:true}}
];
let bewerbungen = JSON.parse(localStorage.getItem('bewerbungen')) || [];
let entbannungen = JSON.parse(localStorage.getItem('entbannungen')) || [];

function saveAll(){
  localStorage.setItem('team', JSON.stringify(team));
  localStorage.setItem('bewerbungen', JSON.stringify(bewerbungen));
  localStorage.setItem('entbannungen', JSON.stringify(entbannungen));
}

function showSection(id){
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

// Bewerbung speichern
document.getElementById("bewerbungForm").addEventListener("submit", e=>{
  e.preventDefault();
  const art = document.getElementById("bewerbungsArt").value;
  const pos = art==="Teambewerbung" ? document.getElementById("bewerbungPosition").value : "-";
  const entry = {
    datum:new Date().toLocaleString(),
    art:art,
    position:pos,
    discord:document.getElementById("bewerbungDiscord").value,
    minecraft:document.getElementById("bewerbungMinecraft").value,
    email:document.getElementById("bewerbungEmail").value,
    text:document.getElementById("bewerbungText").value
  };
  bewerbungen.push(entry);
  saveAll();
  alert("Bewerbung wurde eingereicht!");
  e.target.reset();
  toggleTeamPosition();
});

// Entbannung speichern
document.getElementById("entbannungForm").addEventListener("submit", e=>{
  e.preventDefault();
  const entry={
    datum:new Date().toLocaleString(),
    minecraft:document.getElementById("entbannMinecraft").value,
    discord:document.getElementById("entbannDiscord").value,
    email:document.getElementById("entbannEmail").value,
    text:document.getElementById("entbannText").value,
    discordban:document.getElementById("entbannDiscordBan").checked
  };
  entbannungen.push(entry);
  saveAll();
  alert("Entbannungsantrag wurde eingereicht!");
  e.target.reset();
});

// LOGIN
document.getElementById("loginForm").addEventListener("submit", e=>{
  e.preventDefault();
  const user=document.getElementById("loginUser").value;
  const pass=document.getElementById("loginPass").value;
  const found=team.find(t=>t.name===user && t.pass===pass);
  if(found){
    currentUser=found;
    document.getElementById("loginForm").style.display="none";
    document.getElementById("panelContent").style.display="block";
    renderPanel();
  } else alert("Falsche Zugangsdaten!");
});

function toggleTeamPosition(){
  document.getElementById("teamPositionDiv").style.display=
    document.getElementById("bewerbungsArt").value==="Teambewerbung"?"block":"none";
}

// Render Panel
function renderPanel(){
  const btbody=document.querySelector("#bewerbungTable tbody");
  btbody.innerHTML="";
  bewerbungen.forEach(b=>{
    if((b.art==="Teambewerbung" && !currentUser.permissions.teamApps) ||
       (b.art==="Fraktionsbewerbung" && !currentUser.permissions.fracApps)) return;
    btbody.innerHTML+=`<tr><td>${b.datum}</td><td>${b.art}</td><td>${b.position}</td><td>${b.discord}</td><td>${b.minecraft}</td><td>${b.email}</td><td>${b.text}</td></tr>`;
  });

  const etbody=document.querySelector("#entbannTable tbody");
  etbody.innerHTML="";
  entbannungen.forEach(e=>{
    if(!currentUser.permissions.bans) return;
    etbody.innerHTML+=`<tr><td>${e.datum}</td><td>${e.minecraft}</td><td>${e.discord}</td><td>${e.email}</td><td>${e.text}</td><td>${e.discordban?"Ja":"Nein"}</td></tr>`;
  });

  const tdiv=document.getElementById("teamManageArea");
  tdiv.innerHTML="";
  if(currentUser.name==="Leitung" || currentUser.permissions.teamManage){
    let html=`<form id="teamCreateForm">
      <input type="text" id="newName" placeholder="Name" required>
      <input type="text" id="newRole" placeholder="Rolle" required>
      <input type="password" id="newPass" placeholder="Passwort" required>
      <button type="submit">Teamaccount erstellen</button>
    </form>`;
    html+=`<table><thead><tr><th>Name</th><th>Rolle</th><th>Aktion</th></tr></thead><tbody>`;
    team.forEach((m,i)=>{
      const canEdit=(currentUser.name==="Leitung"||currentUser.permissions.teamManage)&&m.name!=="Leitung";
      html+=`<tr><td>${m.name}</td><td>${m.role}</td><td>${canEdit?`<button class='action-btn' onclick='openManage(${i})'>Verwalten</button>`:"—"}</td></tr>`;
    });
    html+=`</tbody></table><div id="manageView" style="display:none;"><h3 id="manageTitle"></h3><div id="permissionControls"></div><button onclick="backToTeam()">Zurück</button></div>`;
    tdiv.innerHTML=html;

    document.getElementById("teamCreateForm").addEventListener("submit",ev=>{
      ev.preventDefault();
      team.push({name:document.getElementById("newName").value, role:document.getElementById("newRole").value, pass:document.getElementById("newPass").value, permissions:{teamManage:false,teamApps:false,fracApps:false,bans:false}});
      saveAll(); renderPanel();
    });
  }
}

// MANAGE VIEW
let selectedIndex=null;
function openManage(i){
  selectedIndex=i;
  document.querySelector("#teamManageArea table").style.display="none";
  document.querySelector("#manageView").style.display="block";
  const m=team[i];
  document.getElementById("manageTitle").innerText=`Berechtigungen von ${m.name}`;
  const perms=[
    {key:"teamManage",label:"Team Accounts verwalten"},
    {key:"teamApps",label:"Teambewerbungen einsehen"},
    {key:"fracApps",label:"Fraktionsbewerbungen einsehen"},
    {key:"bans",label:"Entbannungsanträge einsehen"}
  ];
  const container=document.getElementById("permissionControls");
  container.innerHTML="";
  perms.forEach(p=>{
    const state=m.permissions[p.key];
    container.innerHTML+=`
      <div>
        <span>${p.label}</span><br>
        <button class="permission-toggle ${state?'active':'inactive'}" onclick="togglePermission('${p.key}',this)">
          ${state?'Ja':'Nein'}
        </button>
      </div>`;
  });
}

function togglePermission(key,btn){
  const m=team[selectedIndex];
  m.permissions[key]=!m.permissions[key];
  btn.classList.toggle("active",m.permissions[key]);
  btn.classList.toggle("inactive",!m.permissions[key]);
  btn.innerText=m.permissions[key]?"Ja":"Nein";
  saveAll();
}

function backToTeam(){
  document.querySelector("#manageView").style.display="none";
  document.querySelector("#teamManageArea table").style.display="table";
  renderPanel();
}
</script>
</body>
</html>
