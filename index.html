<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SunriseRP – Adminpanel</title>
<style>
/* ===== Grundlayout ===== */
body {
    font-family: 'Poppins', sans-serif;
    margin: 0;
    color: #fff;
    background: url('sunriserp.png') center/cover fixed no-repeat;
}
header {
    background: rgba(0,0,0,0.6);
    text-align: center;
    padding: 20px;
    font-size: 24px;
    letter-spacing: 2px;
    text-shadow: 0 0 10px #ffbb55;
}
nav {
    text-align: center;
    background: rgba(0,0,0,0.4);
    padding: 10px;
}
nav button {
    background: rgba(255,255,255,0.15);
    border: none;
    color: #fff;
    padding: 10px 20px;
    margin: 5px;
    border-radius: 5px;
    cursor: pointer;
    transition: 0.3s;
}
nav button:hover { background: rgba(255,200,120,0.4); }
section {
    display: none;
    padding: 20px;
    margin: 20px auto;
    max-width: 1000px;
    background: rgba(0,0,0,0.55);
    border-radius: 10px;
}
section.active { display: block; }
h2, h3 {
    text-align: center;
    color: #ffbb55;
    text-shadow: 0 0 10px #ffbb55;
}
table {
    width: 100%;
    border-collapse: collapse;
    color: #fff;
}
th, td { border: 1px solid rgba(255,255,255,0.3); padding: 8px; text-align: center; }
input, select, textarea, button { padding: 8px; border: none; border-radius: 4px; margin: 5px 0; font-family: inherit; }
textarea { width: 95%; min-height: 60px; }
.avatar { border-radius: 50%; width: 50px; height: 50px; object-fit: cover; }
.save-btn, .login-form button, .action-btn { background: #ffbb55; color: #000; cursor: pointer; transition: 0.3s; }
.save-btn:hover, .login-form button:hover, .action-btn:hover { background: #ffd480; }
.status-select, .notiz-input { padding: 4px; border-radius: 4px; }
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.8);
    justify-content: center;
    align-items: center;
}
.modal-content {
    background: rgba(0,0,0,0.9);
    padding: 20px;
    border-radius: 10px;
    width: 500px;
    color: #fff;
    max-height: 90vh;
    overflow-y: auto;
}
.modal-content h3 { margin-top: 0; text-align: center; }
.close-modal { cursor: pointer; color: #ffbb55; float: right; font-weight: bold; }
</style>
</head>
<body>

<header>☀️ Sunrise Roleplay – Minecraft RP auf hohem Niveau</header>

<nav>
<button onclick="showSection('regelwerk')">Regelwerk</button>
<button onclick="showSection('news')">News</button>
<button onclick="showSection('team')">Team</button>
<button onclick="showSection('bewerbung')">Bewerben</button>
<button onclick="showSection('entbannung')">Entbannung</button>
<button onclick="showSection('panel')">Admin Panel</button>
</nav>

<!-- ===== Regelwerk ===== -->
<section id="regelwerk" class="active">
<h2>Regelwerk SunriseRP</h2>
<pre style="white-space: pre-wrap; font-family: inherit;">
... hier kommt dein vollständiges Regelwerk rein ...
</pre>
</section>

<!-- ===== News ===== -->
<section id="news">
<h2>News</h2>
<div id="news-list"></div>
</section>

<!-- ===== Team ===== -->
<section id="team">
<h2>Teammitglieder</h2>
<table class="team-table">
<thead><tr><th>Avatar</th><th>Name</th><th>Rolle</th></tr></thead>
<tbody></tbody>
</table>
</section>

<!-- ===== Bewerbung ===== -->
<section id="bewerbung">
<h2>Bewerbung einreichen</h2>
<form class="bewerbung-form">
<select class="bewerbungs-art" onchange="togglePositionField()">
<option value="Firmenbewerbung">Firmenbewerbung</option>
<option value="Teambewerbung">Teambewerbung</option>
</select>
<div class="team-positionen" style="display:none;">
<select class="bewerbung-position" required>
<option value="Supporter">Test Supporter</option>
<option value="Builder">Test Builder</option>
<option value="Developer">Test Developer</option>
<option value="Designer">Test Designer</option>
<option value="Content Creator">Test Content Creator</option>
</select>
</div>
<input type="text" class="bewerbung-discord" placeholder="Discord Name" required>
<input type="text" class="bewerbung-minecraft" placeholder="Minecraft Name" required>
<input type="email" class="bewerbung-email" placeholder="E-Mail" required>
<textarea class="bewerbung-text" placeholder="Warum bewirbst du dich?" required></textarea>
<button type="submit">Absenden</button>
</form>
</section>

<!-- ===== Entbannung ===== -->
<section id="entbannung">
<h2>Entbannungsantrag</h2>
<form class="entbannung-form">
<input type="text" class="entbannung-minecraft" placeholder="Minecraft Name" required>
<input type="text" class="entbannung-discord" placeholder="Discord Name" required>
<input type="email" class="entbannung-email" placeholder="E-Mail" required>
<label><input type="checkbox" class="entbannung-discordban"> Discord Bann?</label>
<textarea class="entbannung-text" placeholder="Warum möchtest du entbannt werden?" required></textarea>
<button type="submit">Absenden</button>
</form>
</section>

<!-- ===== Admin Panel ===== -->
<section id="panel">
<h2>Admin Panel</h2>
<form class="login-form">
<input type="text" class="login-user" placeholder="Benutzername" required>
<input type="password" class="login-pass" placeholder="Passwort" required>
<button type="submit">Login</button>
</form>
<div class="panel-content" style="display:none;">
<h3>News erstellen</h3>
<form class="news-form" id="news-form-section">
<input type="text" class="news-title" placeholder="Titel" required>
<input type="file" class="news-img" accept="image/*">
<textarea class="news-text" placeholder="Text" required></textarea>
<button type="submit">News erstellen</button>
</form>

<h3>Bewerbungen</h3>
<table class="bewerbungen-table">
<thead><tr><th>Art</th><th>Minecraft</th><th>Discord</th><th>Bearbeiter/Notiz</th></tr></thead>
<tbody></tbody>
</table>

<h3>Entbannungen</h3>
<table class="entbannungen-table">
<thead><tr><th>Minecraft</th><th>Discord</th><th>Bearbeiter/Notiz</th></tr></thead>
<tbody></tbody>
</table>

<h3 id="team-create-title">Teamverwaltung</h3>
<form class="team-create-form" id="team-create-form-section">
<input type="text" class="team-name" placeholder="Name" required>
<input type="text" class="team-role" placeholder="Rolle" required>
<input type="password" class="team-pass" placeholder="Passwort" required>
<input type="file" class="team-avatar" accept="image/png">
<img id="avatar-preview" src="sunriserp.png" class="avatar">
<button type="submit">Teamaccount erstellen</button>
</form>

<table class="team-accounts-table">
<thead><tr><th>Name</th><th>Rolle</th><th>Avatar</th><th>Bearbeiten</th></tr></thead>
<tbody></tbody>
</table>
</div>
</section>

<!-- ===== Modals ===== -->
<div class="modal" id="team-modal">
<div class="modal-content">
<span class="close-modal" onclick="closeModal()">×</span>
<h3>Teammitglied bearbeiten</h3>
<label>Name: <input type="text" id="modal-name"></label>
<label>Rolle: <input type="text" id="modal-role"></label>
<label>Passwort: <input type="text" id="modal-pass"></label>
<label><input type="checkbox" id="perm-bans"> Entbannungen bearbeiten</label>
<label><input type="checkbox" id="perm-teamapps"> Team-Bewerbungen bearbeiten</label>
<label><input type="checkbox" id="perm-fraktionapps"> Firmen-Bewerbungen bearbeiten</label>
<label><input type="checkbox" id="perm-news"> News erstellen</label>
<label><input type="checkbox" id="perm-teamAccountsVerwalten"> Team Account verwalten</label>
<button id="save-team">Speichern</button>
<button id="delete-team">Account löschen</button>
</div>
</div>

<div class="modal" id="antrag-modal">
<div class="modal-content">
<span class="close-modal" onclick="closeAntragModal()">×</span>
<h3 id="antrag-modal-title"></h3>
<div id="antrag-modal-content"></div>
<label>Notiz:</label>
<textarea id="antrag-modal-notiz"></textarea>
<button id="save-antrag">Speichern</button>
</div>
</div>

<script>
// ================== Globale Variablen ==================
let teamMembers = JSON.parse(localStorage.getItem('teamMembers')) || [];
let bewerbungen = JSON.parse(localStorage.getItem('bewerbungen')) || [];
let entbannungen = JSON.parse(localStorage.getItem('entbannungen')) || [];
let news = JSON.parse(localStorage.getItem('news')) || [];
let currentUser = null;
let editingIndex = null;
let currentAntragIndex = null;
let currentAntragType = null;

// ===== Initialer Leitung-Account =====
if(!teamMembers.find(m=>m.name==='Leitung')){
    teamMembers.unshift({
        name:'Leitung', role:'Leitung', pass:'Leitung7??698145!13076$$23', avatar:'sunriserp.png',
        permissions:{bans:true,teamApps:true,fraktionApps:true,news:true,teamAccountsVerwalten:true}
    });
    localStorage.setItem('teamMembers', JSON.stringify(teamMembers));
}

// ================== Funktionen ==================
function showSection(id){
    document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

function togglePositionField(){
    document.querySelector('.team-positionen').style.display =
        document.querySelector('.bewerbungs-art').value==='Teambewerbung'?'block':'none';
}

// ===== Bewerbungen =====
document.querySelector('.bewerbung-form').addEventListener('submit', e=>{
    e.preventDefault();
    const art = document.querySelector('.bewerbungs-art').value;
    const discord = document.querySelector('.bewerbung-discord').value;
    const minecraft = document.querySelector('.bewerbung-minecraft').value;
    const email = document.querySelector('.bewerbung-email').value;
    const pos = document.querySelector('.bewerbung-position')?.value || '';
    const text = document.querySelector('.bewerbung-text').value;
    bewerbungen.push({datum:new Date().toLocaleString(), art, discord, minecraft, email, position: pos, text, notiz:'', bearbeiter:''});
    localStorage.setItem('bewerbungen', JSON.stringify(bewerbungen));
    e.target.reset();
    alert('Bewerbung abgeschickt!');
    renderBewerbungen();
});

// ===== Entbannungen =====
document.querySelector('.entbannung-form').addEventListener('submit', e=>{
    e.preventDefault();
    const minecraft = document.querySelector('.entbannung-minecraft').value;
    const discord = document.querySelector('.entbannung-discord').value;
    const email = document.querySelector('.entbannung-email').value;
    const discordban = document.querySelector('.entbannung-discordban').checked;
    const text = document.querySelector('.entbannung-text').value;
    entbannungen.push({datum:new Date().toLocaleString(), minecraft, discord, email, discordban, text, notiz:'', bearbeiter:''});
    localStorage.setItem('entbannungen', JSON.stringify(entbannungen));
    e.target.reset();
    alert('Entbannungsantrag abgeschickt!');
    renderEntbannungen();
});

// ===== Admin Login =====
document.querySelector('.login-form').addEventListener('submit', e=>{
    e.preventDefault();
    const user=document.querySelector('.login-user').value;
    const pass=document.querySelector('.login-pass').value;
    const u=teamMembers.find(m=>m.name===user && m.pass===pass);
    if(u){
        currentUser=u;
        alert('Erfolgreich eingeloggt!');
        document.querySelector('.panel-content').style.display='block';
        applyPermissions();
        renderPanel(); renderNews(); renderBewerbungen(); renderEntbannungen(); renderTeam();
    } else alert('Falscher Benutzername oder Passwort!');
});

function applyPermissions(){
    document.getElementById('news-form-section').style.display=currentUser.permissions.news||currentUser.role==='Leitung'?'block':'none';
    document.getElementById('team-create-form-section').style.display=currentUser.permissions.teamAccountsVerwalten||currentUser.role==='Leitung'?'block':'none';
    document.getElementById('team-create-title').style.display=currentUser.permissions.teamAccountsVerwalten||currentUser.role==='Leitung'?'block':'none';
}

// ===== Team erstellen =====
document.querySelector('.team-create-form').addEventListener('submit', e=>{
    e.preventDefault();
    const name=document.querySelector('.team-name').value;
    const role=document.querySelector('.team-role').value;
    const pass=document.querySelector('.team-pass').value;
    const avatar=document.getElementById('avatar-preview').src;
    teamMembers.push({name, role, pass, avatar, permissions:{bans:false, teamApps:false, fraktionApps:false, news:false, teamAccountsVerwalten:true}});
    localStorage.setItem('teamMembers', JSON.stringify(teamMembers));
    e.target.reset();
    document.getElementById('avatar-preview').src='sunriserp.png';
    renderTeam(); renderPanel();
});

document.querySelector('.team-avatar').addEventListener('change', e=>{
    const file=e.target.files[0];
    if(file){
        const reader=new FileReader();
        reader.onload=ev=>document.getElementById('avatar-preview').src=ev.target.result;
        reader.readAsDataURL(file);
    }
});

// ===== Rendering Funktionen =====
function renderTeam(){
    const tbody=document.querySelector('.team-table tbody');
    tbody.innerHTML='';
    teamMembers.forEach(m=>{
        tbody.innerHTML+=`<tr><td><img src="${m.avatar}" class="avatar"></td><td>${m.name}</td><td>${m.role}</td></tr>`;
    });
}

function renderPanel(){
    const tbodyT=document.querySelector('.team-accounts-table tbody');
    tbodyT.innerHTML='';
    teamMembers.forEach((m,i)=>{
        const canEdit=currentUser.permissions.teamAccountsVerwalten||currentUser.role==='Leitung';
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${m.name}</td><td>${m.role}</td><td><img src="${m.avatar}" class="avatar"></td>`;
        if(canEdit && m.name!=='Leitung'){
            const td=document.createElement('td');
            const btn=document.createElement('button');
            btn.classList.add('action-btn');
            btn.textContent='Bearbeiten';
            btn.addEventListener('click',()=>openModal(i));
            td.appendChild(btn);
            tr.appendChild(td);
        } else tr.innerHTML+='<td></td>';
        tbodyT.appendChild(tr);
    });
}

// ===== Bewerbungen rendern =====
function renderBewerbungen() {
    const tbody = document.querySelector('.bewerbungen-table tbody');
    tbody.innerHTML = '';

    bewerbungen.forEach((b, i) => {
        const canView = (b.art === 'Teambewerbung' && currentUser?.permissions.teamApps) ||
                        (b.art === 'Firmenbewerbung' && currentUser?.permissions.fraktionApps) ||
                        currentUser?.role === 'Leitung';
        if (!canView) return;

        const tr = document.createElement('tr');
        tr.style.cursor = 'pointer';
        tr.innerHTML = `
            <td>${b.art}</td>
            <td>${b.minecraft}</td>
            <td>${b.discord}</td>
            <td>${b.bearbeiter ? b.bearbeiter : '-'}</td>
        `;
        tr.addEventListener('click', () => openAntrag('bewerbung', i));
        tbody.appendChild(tr);
    });
}

// ===== Entbannungen rendern =====
function renderEntbannungen() {
    const tbody = document.querySelector('.entbannungen-table tbody');
    tbody.innerHTML = '';

    entbannungen.forEach((b, i) => {
        const canView = currentUser?.permissions.bans || currentUser?.role === 'Leitung';
        if (!canView) return;

        const tr = document.createElement('tr');
        tr.style.cursor = 'pointer';
        tr.innerHTML = `
            <td>${b.minecraft}</td>
            <td>${b.discord}</td>
            <td>${b.bearbeiter ? b.bearbeiter : '-'}</td>
        `;
        tr.addEventListener('click', () => openAntrag('entbannung', i));
        tbody.appendChild(tr);
    });
}

// ===== Modal Funktionen =====
function openModal(i){
    editingIndex=i;
    const m=teamMembers[i];
    document.getElementById('modal-name').value=m.name;
    document.getElementById('modal-role').value=m.role;
    document.getElementById('modal-pass').value=m.pass;
    document.getElementById('perm-bans').checked=m.permissions.bans;
    document.getElementById('perm-teamapps').checked=m.permissions.teamApps;
    document.getElementById('perm-fraktionapps').checked=m.permissions.fraktionApps;
    document.getElementById('perm-news').checked=m.permissions.news;
    document.getElementById('perm-teamAccountsVerwalten').checked=m.permissions.teamAccountsVerwalten;
    document.getElementById('team-modal').style.display='flex';
}

document.getElementById('save-team').addEventListener('click', ()=>{
    const m=teamMembers[editingIndex];
    m.name=document.getElementById('modal-name').value;
    m.role=document.getElementById('modal-role').value;
    m.pass=document.getElementById('modal-pass').value;
    m.permissions.bans=document.getElementById('perm-bans').checked;
    m.permissions.teamApps=document.getElementById('perm-teamapps').checked;
    m.permissions.fraktionApps=document.getElementById('perm-fraktionapps').checked;
    m.permissions.news=document.getElementById('perm-news').checked;
    m.permissions.teamAccountsVerwalten=document.getElementById('perm-teamAccountsVerwalten').checked;
    localStorage.setItem('teamMembers', JSON.stringify(teamMembers));
    renderTeam(); renderPanel(); closeModal();
});

document.getElementById('delete-team').addEventListener('click', ()=>{
    if(confirm('Willst du diesen Account wirklich löschen?')){
        teamMembers.splice(editingIndex,1);
        localStorage.setItem('teamMembers', JSON.stringify(teamMembers));
        renderTeam(); renderPanel(); closeModal();
    }
});

function closeModal(){document.getElementById('team-modal').style.display='none';}

// ===== Antrag Modal =====
function openAntrag(type,index){
    currentAntragType=type;
    currentAntragIndex=index;
    const data=type==='bewerbung'?bewerbungen[index]:entbannungen[index];
    document.getElementById('antrag-modal-title').innerText=type==='bewerbung'?'Bewerbung':'Entbannungsantrag';
    document.getElementById('antrag-modal-content').innerHTML=JSON.stringify(data,null,2);
    document.getElementById('antrag-modal-notiz').value=data.notiz||'';
    document.getElementById('antrag-modal').style.display='flex';
}

document.getElementById('save-antrag').addEventListener('click', ()=>{
    const data=currentAntragType==='bewerbung'?bewerbungen[currentAntragIndex]:entbannungen[currentAntragIndex];
    data.notiz=document.getElementById('antrag-modal-notiz').value;
    data.bearbeiter=currentUser.name;
    if(currentAntragType==='bewerbung') localStorage.setItem('bewerbungen', JSON.stringify(bewerbungen));
    else localStorage.setItem('entbannungen', JSON.stringify(entbannungen));
    renderBewerbungen(); renderEntbannungen();
    closeAntragModal();
});

function closeAntragModal(){document.getElementById('antrag-modal').style.display='none';}

// ===== News erstellen =====
document.querySelector('.news-form').addEventListener('submit', e=>{
    e.preventDefault();
    const title=document.querySelector('.news-title').value;
    const text=document.querySelector('.news-text').value;
    const imgFile=document.querySelector('.news-img').files[0];
    if(imgFile){
        const reader=new FileReader();
        reader.onload=ev=>{
            news.push({datum:new Date().toLocaleString(),title,text,img:ev.target.result});
            localStorage.setItem('news', JSON.stringify(news));
            renderNews();
        };
        reader.readAsDataURL(imgFile);
    } else {
        news.push({datum:new Date().toLocaleString(),title,text,img:''});
        localStorage.setItem('news', JSON.stringify(news));
        renderNews();
    }
    e.target.reset();
});

function renderNews(){
    const div=document.getElementById('news-list'); div.innerHTML='';
    news.slice().reverse().forEach(n=>{
        div.innerHTML+=`<div style="margin-bottom:20px;background:rgba(0,0,0,0.6);padding:10px;border-radius:5px;">
        <h3>${n.title}</h3><p>${n.datum}</p>${n.img?`<img src="${n.img}" style="max-width:100%;height:auto;">`:''}<p>${n.text}</p></div>`;
    });
}

// ===== Initial Render =====
renderTeam();
renderBewerbungen();
renderEntbannungen();
renderNews();
</script>
</body>
</html>
